from pydivert import WinDivert, Layer

def main():
    filter_str = "udp.SrcPort == 68 && udp.DstPort == 67"

    w = WinDivert(filter_str, layer=Layer.NETWORK_FORWARD) # FORWARD Layer
    w.open()

    print("[*] Dropping DHCP Requests (68 â†’ 67)")

    try:
        while True:
            packet = w.recv() # If you only call recv() and not send(), it will be automatically dropped.
            print(f"[!] Dropped DHCP Request from {packet.src_addr}:{packet.src_port}")
    except KeyboardInterrupt:
        pass
    finally:
        w.close()

if __name__ == "__main__":
    main()
